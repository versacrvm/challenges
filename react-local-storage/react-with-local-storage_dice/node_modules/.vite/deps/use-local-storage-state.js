import {
  __toESM,
  require_react
} from "./chunk-QI53LHDY.js";

// node_modules/use-local-storage-state/src/useLocalStorageState.js
var import_react = __toESM(require_react(), 1);
var inMemoryData = /* @__PURE__ */ new Map();
function useLocalStorageState(key, options) {
  const [defaultValue] = (0, import_react.useState)(options === null || options === void 0 ? void 0 : options.defaultValue);
  if (typeof window === "undefined") {
    return [
      defaultValue,
      () => {
      },
      {
        isPersistent: true,
        removeItem: () => {
        }
      }
    ];
  }
  const serializer = options === null || options === void 0 ? void 0 : options.serializer;
  return useBrowserLocalStorageState(key, defaultValue, options === null || options === void 0 ? void 0 : options.storageSync, serializer === null || serializer === void 0 ? void 0 : serializer.parse, serializer === null || serializer === void 0 ? void 0 : serializer.stringify);
}
function useBrowserLocalStorageState(key, defaultValue, storageSync = true, parse = parseJSON, stringify = JSON.stringify) {
  if (!inMemoryData.has(key) && defaultValue !== void 0 && goodTry(() => localStorage.getItem(key)) === null) {
    goodTry(() => localStorage.setItem(key, stringify(defaultValue)));
  }
  const storageValue = (0, import_react.useRef)({
    item: null,
    parsed: defaultValue
  });
  const value = (0, import_react.useSyncExternalStore)(
    (0, import_react.useCallback)((onStoreChange) => {
      const onChange = (localKey) => {
        if (key === localKey) {
          onStoreChange();
        }
      };
      callbacks.add(onChange);
      return () => {
        callbacks.delete(onChange);
      };
    }, [key]),
    // eslint-disable-next-line react-hooks/exhaustive-deps
    () => {
      var _a;
      const item = (_a = goodTry(() => localStorage.getItem(key))) !== null && _a !== void 0 ? _a : null;
      if (inMemoryData.has(key)) {
        storageValue.current = {
          item,
          parsed: inMemoryData.get(key)
        };
      } else if (item !== storageValue.current.item) {
        let parsed;
        try {
          parsed = item === null ? defaultValue : parse(item);
        } catch (_b) {
          parsed = defaultValue;
        }
        storageValue.current = {
          item,
          parsed
        };
      }
      return storageValue.current.parsed;
    },
    // istanbul ignore next
    () => defaultValue
  );
  const setState = (0, import_react.useCallback)((newValue) => {
    const value2 = newValue instanceof Function ? newValue(storageValue.current.parsed) : newValue;
    try {
      localStorage.setItem(key, stringify(value2));
      inMemoryData.delete(key);
    } catch (_a) {
      inMemoryData.set(key, value2);
    }
    triggerCallbacks(key);
  }, [key, stringify]);
  (0, import_react.useEffect)(() => {
    if (!storageSync) {
      return void 0;
    }
    const onStorage = (e) => {
      if (e.storageArea === goodTry(() => localStorage) && e.key === key) {
        triggerCallbacks(key);
      }
    };
    window.addEventListener("storage", onStorage);
    return () => window.removeEventListener("storage", onStorage);
  }, [key, storageSync]);
  return (0, import_react.useMemo)(() => [
    value,
    setState,
    {
      isPersistent: value === defaultValue || !inMemoryData.has(key),
      removeItem() {
        goodTry(() => localStorage.removeItem(key));
        inMemoryData.delete(key);
        triggerCallbacks(key);
      }
    }
  ], [key, setState, value, defaultValue]);
}
var callbacks = /* @__PURE__ */ new Set();
function triggerCallbacks(key) {
  for (const callback of [...callbacks]) {
    callback(key);
  }
}
function parseJSON(value) {
  return value === "undefined" ? void 0 : JSON.parse(value);
}
function goodTry(tryFn) {
  try {
    return tryFn();
  } catch (_a) {
    return void 0;
  }
}

// node_modules/use-local-storage-state/index.js
var use_local_storage_state_default = useLocalStorageState;
export {
  use_local_storage_state_default as default
};
//# sourceMappingURL=use-local-storage-state.js.map
